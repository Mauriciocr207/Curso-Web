{"version":3,"sources":["horas.js"],"names":["document","querySelector","busqueda","id_categoria","dia","categoria","dias","querySelectorAll","inputHiddenDia","inputHiddenHora","name","value","forEach","checked","Object","values","includes","buscarEventos","terminoBusqueda","e","target","horaPrevia","classList","remove","async","url","resultado","fetch","eventoshorarios","listadoHoras","li","add","horasTomadas","map","eventohorario","id_hora","listadoHorasArray","Array","from","filter","parseInt","dataset","idHora","horaLi","removeEventListener","seleccionarHora","horaDisponible","addEventListener","obtenerHorasDisponibles","json"],"mappings":"AAAA,MAEI,GADcA,SAASC,cAAc,UAC3B,CACN,IAAIC,EAAW,CACXC,aAAc,GACdC,IAAK,IAET,MAAMC,EAAYL,SAASC,cAAc,yBACnCK,EAAON,SAASO,iBAAiB,gBACjCC,EAAiBR,SAASC,cAAc,mBACxCQ,EAAkBT,SAASC,cAAc,oBAG/CC,EAASG,EAAUK,MAAQL,EAAUM,MACrCT,EAASI,EAAK,GAAGI,MAAQF,EAAeG,MACxCL,EAAKM,QAASR,IACPA,EAAIO,QAAUH,EAAeG,QAAOP,EAAIS,SAAU,KAGrDC,OAAOC,OAAOb,GAAUc,SAAS,KACjCC,IAaJ,SAASC,EAAgBC,GACrBjB,EAASiB,EAAEC,OAAOV,MAAQS,EAAEC,OAAOT,MAGnCF,EAAgBE,MAAQ,GACxBH,EAAeG,MAAQ,GAEvB,MAAMU,EAAarB,SAASC,cAAc,8BACvCoB,GAAYA,EAAWC,UAAUC,OAAO,6BAGvCT,OAAOC,OAAOb,GAAUc,SAAS,KACjCC,IAIRO,eAAeP,IACX,MAAMd,aAACA,EAAYC,IAAEA,GAAOF,EACtBuB,EAAM,gCAAgCrB,kBAAoBD,IAC1DuB,QAAkBC,MAAMF,IAKlC,SAAiCG,EAAkB,IAG/C,MAAMC,EAAe7B,SAASO,iBAAiB,aAC/CsB,EAAajB,QAASkB,GAAMA,EAAGR,UAAUS,IAAI,+BAI7C,MAAMC,EAAeJ,EAAgBK,IAAKC,GAAiBA,EAAcC,SAEnEC,EAAoBC,MAAMC,KAAKT,GAEnBO,EAAkBG,OAAQT,IAAOE,EAAahB,SAASwB,SAASV,EAAGW,QAAQC,UAEnF9B,QAASkB,GAAMA,EAAGR,UAAUC,OAAO,+BAG7BvB,SAASO,iBAAiB,gBAClCK,QAAS+B,GAAUA,EAAOC,oBAAoB,QAASC,IAGtC7C,SAASO,iBAAiB,8CAClCK,QAASkC,GAAkBA,EAAeC,iBAAiB,QAASF,IAzBrFG,OAD8BtB,EAAUuB,QA6B5C,SAASJ,EAAgB1B,GAErB,MAAME,EAAarB,SAASC,cAAc,8BACvCoB,GAAYA,EAAWC,UAAUC,OAAO,6BAE3CJ,EAAEC,OAAOE,UAAUS,IAAI,6BAEvBtB,EAAgBE,MAAQQ,EAAEC,OAAOqB,QAAQC,OAEzClC,EAAeG,MAAQX,SAASC,cAAc,wBAAwBU,MArEjDX,SAASO,iBAAiB,gBAClCK,QAASkC,IACnBA,EAAeL,QAAQC,SAAWjC,EAAgBE,OACjDmC,EAAexB,UAAUS,IAAI,+BAMrC1B,EAAU0C,iBAAiB,QAAS7B,GACpCZ,EAAKM,QAASR,GAAOA,EAAI2C,iBAAiB,QAAS7B,MAhC3D","file":"horas.js","sourcesContent":["(() => {\r\n    const horas = document.querySelector('#horas');\r\n    if(horas) {\r\n        let busqueda = {\r\n            id_categoria: \"\",\r\n            dia: \"\",\r\n        }\r\n        const categoria = document.querySelector('[name=\"id_categoria\"]');\r\n        const dias = document.querySelectorAll('[name=\"dia\"]');\r\n        const inputHiddenDia = document.querySelector('[name=\"id_dia\"]');\r\n        const inputHiddenHora = document.querySelector('[name=\"id_hora\"]');\r\n\r\n        // Seteamos valor inicial de id_categoria | Condiciones iniciales\r\n        busqueda[categoria.name] = categoria.value;\r\n        busqueda[dias[0].name] = inputHiddenDia.value;\r\n        dias.forEach( dia => {\r\n            if(dia.value === inputHiddenDia.value) dia.checked = true;\r\n        })\r\n        // añadimos el listener\r\n        if(!Object.values(busqueda).includes('')) {\r\n            buscarEventos();\r\n        }\r\n        const horasDisponibles = document.querySelectorAll('.horas__hora');\r\n        horasDisponibles.forEach( horaDisponible => {\r\n            if(horaDisponible.dataset.idHora === inputHiddenHora.value) {\r\n                horaDisponible.classList.add('horas__hora--seleccionada');\r\n            }\r\n        })\r\n        \r\n        \r\n        \r\n        categoria.addEventListener('input', terminoBusqueda);\r\n        dias.forEach( dia => dia.addEventListener('input', terminoBusqueda));\r\n        function terminoBusqueda(e) {\r\n            busqueda[e.target.name] = e.target.value;\r\n\r\n            // Reiniciar campos ocultos y el selector de horas\r\n            inputHiddenHora.value = \"\";\r\n            inputHiddenDia.value = \"\";\r\n            // Desahabilitar hora previa, si hay un nuevo click\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            if(horaPrevia) horaPrevia.classList.remove('horas__hora--seleccionada');\r\n\r\n\r\n            if(!Object.values(busqueda).includes('')) {\r\n                buscarEventos();\r\n            }\r\n        }\r\n\r\n        async function buscarEventos() {\r\n            const {id_categoria, dia} = busqueda;\r\n            const url = `/api/eventos-horarios?id_dia=${dia}&id_categoria=${id_categoria}`;\r\n            const resultado = await fetch(url);\r\n            const eventoshorarios = await resultado.json();\r\n            obtenerHorasDisponibles(eventoshorarios);\r\n        }\r\n\r\n        function obtenerHorasDisponibles(eventoshorarios = []) {\r\n            // Reiniciar las horas\r\n            // Obtenemos la nodelist de las horas\r\n            const listadoHoras = document.querySelectorAll('#horas li');\r\n            listadoHoras.forEach( li => li.classList.add('horas__hora--deshabilitada') );\r\n\r\n            // Comprobar eventos ya tomados y quitar la variable de deshabilitado\r\n            // Obtenemos los id de las horas que están tomadas por un evento\r\n            const horasTomadas = eventoshorarios.map( eventohorario => eventohorario.id_hora);\r\n            // Convertimos la nodelist a un array\r\n            const listadoHorasArray = Array.from(listadoHoras);\r\n            // Obtenemos los elementos que tengan un id de horario que no está seleccionado en la base de datos\r\n            const resultado = listadoHorasArray.filter( li => !horasTomadas.includes(parseInt(li.dataset.idHora)));\r\n            // Habilitamos cada elemento permitido\r\n            resultado.forEach( li => li.classList.remove('horas__hora--deshabilitada'))\r\n            \r\n            // removemos el listener a todos los\r\n            const horasLi = document.querySelectorAll('.horas__hora');\r\n            horasLi.forEach( horaLi => horaLi.removeEventListener('click', seleccionarHora));\r\n\r\n            // añadimos el listener\r\n            const horasDisponibles = document.querySelectorAll('#horas li:not(.horas__hora--deshabilitada)');\r\n            horasDisponibles.forEach( horaDisponible => horaDisponible.addEventListener('click', seleccionarHora));\r\n        }\r\n \r\n        function seleccionarHora(e) {\r\n            // Desahabilitar hora previa, si hay un nuevo click\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            if(horaPrevia) horaPrevia.classList.remove('horas__hora--seleccionada');\r\n            // Agregar clase de seleccionado\r\n            e.target.classList.add('horas__hora--seleccionada');\r\n\r\n            inputHiddenHora.value = e.target.dataset.idHora;\r\n            // Llenar el campo oculto de día\r\n            inputHiddenDia.value = document.querySelector('[name=\"dia\"]:checked').value;\r\n        }\r\n    }\r\n})();"]}