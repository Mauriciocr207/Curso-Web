{"version":3,"sources":["horas.js"],"names":["document","querySelector","busqueda","id_categoria","dia","categoria","dias","querySelectorAll","inputHiddenDia","inputHiddenHora","terminoBusqueda","e","target","name","value","horaPrevia","classList","remove","Object","values","includes","buscarEventos","async","url","resultado","fetch","eventoshorarios","listadoHoras","forEach","li","add","horasTomadas","map","eventohorario","id_hora","listadoHorasArray","Array","from","filter","parseInt","dataset","idHora","horaLi","removeEventListener","seleccionarHora","horaDisponible","addEventListener","obtenerHorasDisponibles","json","checked","horaSeleccionada"],"mappings":"AAAA,MAEI,GADcA,SAASC,cAAc,UAC3B,CACN,IAAIC,EAAW,CACXC,aAAc,GACdC,IAAK,IAET,MAAMC,EAAYL,SAASC,cAAc,yBACnCK,EAAON,SAASO,iBAAiB,gBACjCC,EAAiBR,SAASC,cAAc,mBACxCQ,EAAkBT,SAASC,cAAc,oBAoB/C,SAASS,EAAgBC,GACrBT,EAASS,EAAEC,OAAOC,MAAQF,EAAEC,OAAOE,MAGnCL,EAAgBK,MAAQ,GACxBN,EAAeM,MAAQ,GAEvB,MAAMC,EAAaf,SAASC,cAAc,8BACvCc,GAAYA,EAAWC,UAAUC,OAAO,6BAGvCC,OAAOC,OAAOjB,GAAUkB,SAAS,KACjCC,IAIRC,eAAeD,IACX,MAAMlB,aAACA,EAAYC,IAAEA,GAAOF,EACtBqB,EAAM,gCAAgCnB,kBAAoBD,IAC1DqB,QAAkBC,MAAMF,IAKlC,SAAiCG,EAAkB,IAG/C,MAAMC,EAAe3B,SAASO,iBAAiB,aAC/CoB,EAAaC,QAASC,GAAMA,EAAGb,UAAUc,IAAI,+BAI7C,MAAMC,EAAeL,EAAgBM,IAAKC,GAAiBA,EAAcC,SAEnEC,EAAoBC,MAAMC,KAAKV,GAEnBQ,EAAkBG,OAAQT,IAAOE,EAAaX,SAASmB,SAASV,EAAGW,QAAQC,UAEnFb,QAASC,GAAMA,EAAGb,UAAUC,OAAO,+BAG7BjB,SAASO,iBAAiB,gBAClCqB,QAASc,GAAUA,EAAOC,oBAAoB,QAASC,IAGtC5C,SAASO,iBAAiB,8CAClCqB,QAASiB,GAAkBA,EAAeC,iBAAiB,QAASF,IAzBrFG,OAD8BvB,EAAUwB,QA6B5C,SAASJ,EAAgBjC,GAErB,MAAMI,EAAaf,SAASC,cAAc,8BACvCc,GAAYA,EAAWC,UAAUC,OAAO,6BAE3CN,EAAEC,OAAOI,UAAUc,IAAI,6BAEvBrB,EAAgBK,MAAQH,EAAEC,OAAO4B,QAAQC,OAEzCjC,EAAeM,MAAQd,SAASC,cAAc,wBAAwBa,MA3E1EZ,EAASG,EAAUQ,MAAQR,EAAUS,MACrCZ,EAASI,EAAK,GAAGO,MAAQL,EAAeM,MACxCR,EAAKsB,QAASxB,IACPA,EAAIU,QAAUN,EAAeM,QAAOV,EAAI6C,SAAU,KAGrD/B,OAAOC,OAAOjB,GAAUkB,SAAS,KACjC,iBACUC,IAEN,MAAM6B,EAAmBlD,SAASC,cAAc,kBAAkBQ,EAAgBK,WAClFoC,EAAiBlC,UAAUC,OAAO,8BAClCiC,EAAiBlC,UAAUc,IAAI,8BALnC,GAQJzB,EAAUyC,iBAAiB,QAASpC,GACpCJ,EAAKsB,QAASxB,GAAOA,EAAI0C,iBAAiB,QAASpC,MA7B3D","file":"horas.js","sourcesContent":["(() => {\r\n    const horas = document.querySelector('#horas');\r\n    if(horas) {\r\n        let busqueda = {\r\n            id_categoria: \"\",\r\n            dia: \"\",\r\n        }\r\n        const categoria = document.querySelector('[name=\"id_categoria\"]');\r\n        const dias = document.querySelectorAll('[name=\"dia\"]');\r\n        const inputHiddenDia = document.querySelector('[name=\"id_dia\"]');\r\n        const inputHiddenHora = document.querySelector('[name=\"id_hora\"]');\r\n\r\n        // Seteamos valor inicial de id_categoria | Condiciones iniciales\r\n        busqueda[categoria.name] = categoria.value;\r\n        busqueda[dias[0].name] = inputHiddenDia.value;\r\n        dias.forEach( dia => {\r\n            if(dia.value === inputHiddenDia.value) dia.checked = true;\r\n        })\r\n        // añadimos el listener\r\n        if(!Object.values(busqueda).includes('')) {\r\n            (async () => {\r\n                await buscarEventos(); \r\n                // Resaltar la hora actual;\r\n                const horaSeleccionada = document.querySelector(`[data-id-hora=\"${inputHiddenHora.value}\"]`);\r\n                horaSeleccionada.classList.remove('horas__hora--deshabilitada');\r\n                horaSeleccionada.classList.add('horas__hora--seleccionada');\r\n            })();\r\n        }\r\n        categoria.addEventListener('input', terminoBusqueda);\r\n        dias.forEach( dia => dia.addEventListener('input', terminoBusqueda));\r\n        function terminoBusqueda(e) {\r\n            busqueda[e.target.name] = e.target.value;\r\n\r\n            // Reiniciar campos ocultos y el selector de horas\r\n            inputHiddenHora.value = \"\";\r\n            inputHiddenDia.value = \"\";\r\n            // Desahabilitar hora previa, si hay un nuevo click\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            if(horaPrevia) horaPrevia.classList.remove('horas__hora--seleccionada');\r\n\r\n\r\n            if(!Object.values(busqueda).includes('')) {\r\n                buscarEventos();\r\n            }\r\n        }\r\n\r\n        async function buscarEventos() {\r\n            const {id_categoria, dia} = busqueda;\r\n            const url = `/api/eventos-horarios?id_dia=${dia}&id_categoria=${id_categoria}`;\r\n            const resultado = await fetch(url);\r\n            const eventoshorarios = await resultado.json();\r\n            obtenerHorasDisponibles(eventoshorarios);\r\n        }\r\n\r\n        function obtenerHorasDisponibles(eventoshorarios = []) {\r\n            // Reiniciar las horas\r\n            // Obtenemos la nodelist de las horas\r\n            const listadoHoras = document.querySelectorAll('#horas li');\r\n            listadoHoras.forEach( li => li.classList.add('horas__hora--deshabilitada') );\r\n\r\n            // Comprobar eventos ya tomados y quitar la variable de deshabilitado\r\n            // Obtenemos los id de las horas que están tomadas por un evento\r\n            const horasTomadas = eventoshorarios.map( eventohorario => eventohorario.id_hora);\r\n            // Convertimos la nodelist a un array\r\n            const listadoHorasArray = Array.from(listadoHoras);\r\n            // Obtenemos los elementos que tengan un id de horario que no está seleccionado en la base de datos\r\n            const resultado = listadoHorasArray.filter( li => !horasTomadas.includes(parseInt(li.dataset.idHora)));\r\n            // Habilitamos cada elemento permitido\r\n            resultado.forEach( li => li.classList.remove('horas__hora--deshabilitada'))\r\n            \r\n            // removemos el listener a todos los\r\n            const horasLi = document.querySelectorAll('.horas__hora');\r\n            horasLi.forEach( horaLi => horaLi.removeEventListener('click', seleccionarHora));\r\n\r\n            // añadimos el listener\r\n            const horasDisponibles = document.querySelectorAll('#horas li:not(.horas__hora--deshabilitada)');\r\n            horasDisponibles.forEach( horaDisponible => horaDisponible.addEventListener('click', seleccionarHora));\r\n        }\r\n \r\n        function seleccionarHora(e) {\r\n            // Desahabilitar hora previa, si hay un nuevo click\r\n            const horaPrevia = document.querySelector('.horas__hora--seleccionada');\r\n            if(horaPrevia) horaPrevia.classList.remove('horas__hora--seleccionada');\r\n            // Agregar clase de seleccionado\r\n            e.target.classList.add('horas__hora--seleccionada');\r\n\r\n            inputHiddenHora.value = e.target.dataset.idHora;\r\n            // Llenar el campo oculto de día\r\n            inputHiddenDia.value = document.querySelector('[name=\"dia\"]:checked').value;\r\n        }\r\n    }\r\n})();"]}